stages:
  - build
  - test
  - deploy


# build:rosette:
#   stage: build
#   image: nixos/nix
#   script:
#     - cd rosette
#     - nix-build
#     - ./run.sh rbl/rosette/tests/simple_add.rbl
#   tags:
#     - docker


build:p2p-test-network:
  stage: build
  # tags:
  #   - docker 
  # tags:
  #   - alpine37
  # image: docker:stable
  image: alpine:latest
  # variables:
  #   DOCKER_DRIVER: overlay2

  services:
  - docker:dind

   before_script:
  #    - apk update 
  #    - docker info
     - docker ps

  script:
    - export JAVA_HOME="/usr/lib/jvm/java-1.8-openjdk"
    - apk update
    - apk add bash
    - ./scripts/alpine37_install_deps.sh
    - ./scripts/install_secp.sh
    - ./scripts/install_sodium.sh
    - ./scripts/install_bnfc.sh
      # - sbt -Dsbt.log.noformat=true clean rholang/bnfc:generate node/docker
      #- ./scripts/p2p-test-network.sh local && ./scripts/p2p-test-network.sh run-tests 50
    - ./scripts/p2p-test-network.py -b

 
  # build:ubuntu1604-p2p-test-network:
  #   stage: build
  #   tags:
  #     - preloaded-ubuntu1604
  #   # tags:
  #   #   - docker
  #   # image: ubuntu:16.04
  # 
  #   script:
  #       # - ./scripts/ubuntu1604_install_deps.sh
  #     - ./scripts/install_secp.sh
  #     - ./scripts/install_sodium.sh
  #     - ./scripts/install_bnfc.sh
  #     - sudo pip3.6 install argparse docker pexpect
  #       # - sbt -Dsbt.log.noformat=true clean rholang/bnfc:generate node/docker
  #       #- ./scripts/p2p-test-network.sh local && ./scripts/p2p-test-network.sh run-tests 50
  #     - sudo sbt -Dsbt.log.noformat=true clean rholang/bnfc:generate node/docker
  #     - sudo ./scripts/p2p-test-network.py -b
