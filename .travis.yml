language: generic 
dist: trusty
sudo: required
services:
  - docker
env:
  - container_name=rchain-dev

    #docker exec rchain-dev sh -c "mkdir -p /src/rchain; cd /src/rchain; /src/rchain/scripts/ci-install-deps.sh"
    #- docker exec -it rchain-dev /bin/bash
    #- echo $TRAVIS_REPO_SLUG
    #- ls -lhat 



#   - docker ps -a
#   - docker exec -it rchain-dev sh -c "pwd"
#   - exit

    #- docker run -d -it --name rchain-dev ubuntu:16.04
    #- docker exec rchain-dev sh -c "mkdir -p /src/rchain"
    #- docker cp . rchain-dev:/src/rchain/
    # - docker pull ubuntu:16.04 
    #   - docker run -d \
    #         -it \
    #         --name rchain-dev \
    #         -v "$(pwd):/src/rchain" \
    #         ubuntu:16.04
before_install:
    #- docker run -d -it --name prepared-dev-base -v "$(pwd):/src/rchain" jeremybusk/prepared-dev-base:latest
  - docker run -d -it --name "$container_name" -v "$(pwd):/src/rchain" ubuntu:16.04
  - docker exec "$container_name" sh -c "cd /src/rchain; /src/rchain/scripts/ci-install-deps.sh"

    # install:
    #   - docker run -d -it --name prepared-dev-base -v "$(pwd):/src/rchain" ubuntu:16.04
    #   - docker exec prepared-dev-base sh -c "cd /src/rchain; /src/rchain/scripts/ci-install-deps.sh"
    #   - docker login -u "$DOCKER_USERNAME" -p "$DOCKER_PASSWORD";
    #   - docker commit -m "updated" -a "Jeremy Busk" prepared-dev-base $DOCKER_USERNAME/prepared-dev-base:latest
    #   - docker push "$DOCKER_USERNAME/prepared-dev-base"
    #   - docker exec prepared-dev-base sh -c "cd /src/rchain; /src/rchain/scripts/ci-build-subprojects.sh" 
    #
install:
  - docker exec "$container_name" sh -c "cd /src/rchain; /src/rchain/scripts/ci-build-secp.sh" 
  - docker exec "$container_name" sh -c "cd /src/rchain; /src/rchain/scripts/ci-build-subprojects.sh" 
cache:
  directories:
    - "$HOME/.ivy2/cache"
    - "$HOME/.sbt"
notifications:
  email:
    recipients:
      - jeremy@pyrofex.net
    on_success: never
    on_failure: always
# addons:
#     apt:
#         sources:
#             - sourceline: 'deb https://dl.bintray.com/sbt/debian /'
#         packages:
#             - sbt
#             - jflex
#             - haskell-platform

